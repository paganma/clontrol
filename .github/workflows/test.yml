name: Test

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  test:
    strategy:
      matrix:
        os: [ubuntu-latest]
        java-version: ["8", "11", "17", "21"]
        clojure-version: ["1.10.3", "1.11.4", "1.12.0"]

    runs-on: ${{ matrix.os }}

    steps:
    - uses: actions/checkout@v4

    - name: Prepare java
      uses: actions/setup-java@v3
      with:
        distribution: 'zulu'
        java-version: ${{ matrix.java-version }}

    - name: Install clojure tools
      uses: DeLaGuardo/setup-clojure@13.4
      with:
        cli: 1.12.1.1550

    - name: Run tests
      run: clojure -Sdeps '{:deps {org.clojure/clojure {:mvn/version "${{ matrix.clojure-version }}"}}}}' -X:test
